---
title: "Text analysis of Republican and Democratic"
output: html_document
---

```{r, echo=FALSE, warning=FALSE, message=FALSE}
require('wordcloud')
require('biclust')
require('cluster')
require('igraph') 
require('dplyr')
require('scales')
require('SnowballC')
require('RColorBrewer')
require('ggplot2')
require('tm')
# source("https://bioconductor.org/biocLite.R")
# biocLite("Rgraphviz")
require('Rgraphviz')
require('fpc')
require('topicmodels')
require(proxy)

setwd("C:\\Users\\HS\\Desktop\\school\\classes\\VIS\\HW_TEXT\\git\\Edav-Text\\")

load("dtm.Rda")
load("tdm.Rda")

information = read.csv('President_Info3.csv', header=T)

index_republican = information$index[which(information$Political.Party == "Republican")]
index_democrat = information$index[which(information$Political.Party == "Democrat")]

dtm_republican = dtm[index_republican, ]
tdm_republican = tdm[, index_republican]

dtm_democrat = dtm[index_democrat, ]
tdm_democrat = tdm[, index_democrat]

```

Here, we would like to compare difference between Democratic Party and Republican Party. 
We looked at 88 speeches of presidents at Republican, and 84 speeches of presidents at Democrat.

Here are TOP30 words that were used at speeches of Republican.
<p style="text-align: left; font-size:20px; font-weight:bold;">Words frequency of Republican</p>
```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
mfreq_r = colSums(as.matrix(dtm_republican))
mfreq_r_df = data.frame(word=names(mfreq_r),freq=mfreq_r)
mfreq_r_df = mfreq_r_df[order(mfreq_r_df$freq, decreasing=TRUE), ]
mfreq_r_df = mfreq_r_df[1:30, ]
mfreq_r_df = data.frame(id=c(1:30), word=mfreq_r_df$word, freq=mfreq_r_df$freq)
ggplot(mfreq_r_df, aes(x = reorder(word, id), y = freq)) +
  geom_bar(stat = "identity") +
  xlab("Words") +
  ylab("Frequency") +
  theme(axis.text.x=element_text(size=12,color='black',fac='bold.italic',angle=45,hjust=0.5))
```

Here are TOP30 words that were used at speeches of Democrat
<p style="text-align: left; font-size:20px; font-weight:bold;">Words frequency of Democrat</p>
```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
mfreq_d = colSums(as.matrix(dtm_democrat))
mfreq_d_df = data.frame(word=names(mfreq_d),freq=mfreq_d)
mfreq_d_df = mfreq_d_df[order(mfreq_d_df$freq, decreasing=TRUE), ]
mfreq_d_df = mfreq_d_df[1:30, ]
mfreq_d_df = data.frame(id=c(1:30), word=mfreq_d_df$word, freq=mfreq_d_df$freq)
ggplot(mfreq_d_df, aes(x = reorder(word, id), y = freq)) +
  geom_bar(stat = "identity") +
  xlab("Words") +
  ylab("Frequency") +
  theme(axis.text.x=element_text(size=12,color='black',fac='bold.italic',angle=45,hjust=0.5))
```

As we can see above, TOP 3 words were "will"", "state", "govern" at both Republican and Democrat. 
In addition, we can see that almost same words such as as "congress", and "American" were used at both parties.

By using Word Cloud, we can see similarities between both parties visually.

<p style="text-align: left; font-size:20px; font-weight:bold;">Wordcloud of Republic</p>
```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
# republic
set.seed(111)
min_freq = 500
wordcloud(names(mfreq_r),mfreq_r,
          min.freq=min_freq,
          scale=c(4,0.5),
          colors=brewer.pal(8, "Dark2"),
          random.color=FALSE, 
          random.order=FALSE)
```

<p style="text-align: left; font-size:20px; font-weight:bold;">Wordcloud of Democrat</p>
```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
# democrat
set.seed(111)
min_freq = 450
wordcloud(names(mfreq_d),mfreq_d,
          min.freq=min_freq,
          scale=c(4,0.5),
          colors=brewer.pal(8, "Dark2"),
          random.color=FALSE, 
          random.order=FALSE)
```

Here, we will see similarity of speeches between Democrat and Republican by using cosine similarity. Cosine similarity can show the similarity between two vectors, and can be expressed in a range from 0 to 1. 
```{r, echo=FALSE, warning=FALSE, message=FALSE}
## compare similarity of documents between republic and democratic
tdm_republican_mat <- as.matrix(tdm_republican)
colnames(tdm_republican_mat) = index_republican
tdm_democrat_mat <- as.matrix(tdm_democrat)
colnames(tdm_democrat_mat) = index_democrat

tdm_merge_mat = merge(tdm_republican_mat, tdm_democrat_mat, by = "row.names")
tdm_merge_mat = tdm_merge_mat[, 2:dim(tdm_merge_mat)[2]]
cosine_dist_mat <- as.matrix(dist(t(tdm_merge_mat), method = "cosine"))


tmp_row = c(0)
tmp_col = c(0)
tmp_fre = c(0)
tmp_which = c("")
for(i in 1:dim(cosine_dist_mat)[1]) {
  for(j in i:dim(cosine_dist_mat)[1]) {
    tmp_row[length(tmp_row)+1] = i
    tmp_col[length(tmp_col)+1] = j
    tmp_val = ""
    tmp_which[length(length)+1] = 
    tmp_fre[length(tmp_fre)+1] = cosine_dist_mat[i,j]
  }
}
#cosine_dist_ranking_df = data.frame(pair=tmp_pair_index, freq=tmp_frequency)
cosine_dist_ranking_df = data.frame(row=tmp_row, col=tmp_col, freq=tmp_fre)

cosine_dist_ranking_df_rank = cosine_dist_ranking_df[order(cosine_dist_ranking_df$freq, decreasing=TRUE), ]
cosine_dist_ranking_df_rank_top20 = cosine_dist_ranking_df_rank[1:20, ]


which_party_row = c()
which_party_col = c()
for(i in 1:dim(cosine_dist_ranking_df_rank)[1]) {
  if ( cosine_dist_ranking_df_rank[c(i), 'row'] %in% index_democrat ) {  
    which_party_row[length(which_party_row) + 1] = "Democratic"
  } else {
    which_party_row[length(which_party_row) + 1] = "Republican"
  }
  if ( cosine_dist_ranking_df_rank[c(i), 'col'] %in% index_democrat ) {  
    which_party_col[length(which_party_col) + 1] = "Democratic"
  } else {
    which_party_col[length(which_party_col) + 1] = "Republican"
  }  
}

cosine_dist_ranking_df_rank_merged = cbind(cosine_dist_ranking_df_rank, 
                                           data.frame(row_party=which_party_row), 
                                           data.frame(col_party=which_party_col)
                                           )

library(htmlTable)
html_output_cosine = cosine_dist_ranking_df_rank_merged[1:30, ]

for(i in 1:dim(html_output_cosine)[1]) {
  html_output_cosine[c(i), "name1"] = paste(
    as.character(information[information$index == html_output_cosine[c(i), "row"], ]$name), 
    as.character(html_output_cosine[c(i), "row_party"]),
    sep = "/"
    )
  html_output_cosine[c(i), "name2"] = paste(
    as.character(information[information$index == html_output_cosine[c(i), "col"], ]$name), 
    as.character(html_output_cosine[c(i), "col_party"]), 
    sep = "/")
}

d_d = mean( cosine_dist_ranking_df_rank_merged[ (cosine_dist_ranking_df_rank_merged$row_party == "Democratic") &
                                    (cosine_dist_ranking_df_rank_merged$col_party == "Democratic")  , ]$freq )

r_r = mean( cosine_dist_ranking_df_rank_merged[ (cosine_dist_ranking_df_rank_merged$row_party == "Republican") &
                                            (cosine_dist_ranking_df_rank_merged$col_party == "Republican")  , ]$freq )

r_d = mean( cosine_dist_ranking_df_rank_merged[ ((cosine_dist_ranking_df_rank_merged$row_party == "Democratic") &
                                            (cosine_dist_ranking_df_rank_merged$col_party == "Republican")) |
                                            ((cosine_dist_ranking_df_rank_merged$row_party == "Democratic") &
                                               (cosine_dist_ranking_df_rank_merged$col_party == "Republican"))
                                          , ]$freq )
```

<p style="text-align: left; font-size:20px; font-weight:bold;">Top 30 cosine similarity</p>
```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
# output of the ranking of cosine similarity
htmlTable(html_output_cosine[1:30, c("name1", "name2", "freq")], rnames = c(1:30))
```

As we can see above, top row is between Democrat and Democrat, but from second row to ninth row, there are combinations between Republican and Democrat. It is interesting to see that Martin Van Buren(Democratic party) has lots of high similarities between many other presidents. The average cosine similarities of speeches between Democrat and Democrat is `r d_d`, while the cosine similarities between Republican and Republican is `r r_r`. The cosine similarities between Republican and Democrat is `r r_d`.


Before executing this analysis, we thought that we could see the clear difference between Democrat and Republican in terms of contents of speeches. According to bar plots and cosine similarities, contents themselves do not have major difference, if we see speeches from 1790 to 2016. From this results, other factors besides contents of speeches might also be related.


