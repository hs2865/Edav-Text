---
title: "Text Analysis of President Barack Obama and President George W. Bush"
author: "Shuni Fang"
date: "May 11, 2016"
output: html_document
---

```{r, echo=FALSE, warning=FALSE, message=FALSE}
require('wordcloud')
require('biclust')
require('cluster')
require('igraph') 
require('dplyr')
require('scales')
require('SnowballC')
require('RColorBrewer')
require('ggplot2')
require('tm')
require('Rgraphviz')
require('fpc')
require('topicmodels')

# load data
load("dtm.Rda")

information = read.csv('President_Info3.csv', header=T)

index_obama = information$index[which(information$name == "Barack Obama")]
index_bush = information$index[which(information$name == "George W. Bush")]

dtm_obama = dtm[index_obama, ]
dtm_bush = dtm[index_bush, ]
```

We are interested in seeing how each presidents speeches changes overtime. So we pick the two most recent presidents, President Barack Obama and President George W. Bush, to take a closer look of their words frequencies over their tenure of office, ie. we look at the 8 speeches of President Obama and the 9 speeches of President Bush.

Here are TOP10 most frequently used words in speeches of President Obama.
We can easily tell from the plot that President Obama emphasizes on american/america and job/work, which represent the emphasis on the country and the job market.
<p style="text-align: left; font-size:20px; font-weight:bold;">Words frequency of President Barack Obama</p>

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
# bar plot of top10 words of obama
obama = as.matrix(dtm_obama)
mfreq_r = colSums(as.matrix(dtm_obama))
mfreq_r_df = data.frame(word=names(mfreq_r),freq=mfreq_r)
mfreq_r_df = mfreq_r_df[order(mfreq_r_df$freq, decreasing=TRUE), ]
mfreq_r_df = mfreq_r_df[1:10, ]
mfreq_r_df = data.frame(id=c(1:10), word=mfreq_r_df$word, freq=mfreq_r_df$freq)
p1 <- ggplot(mfreq_r_df, aes(x = reorder(word, id), y = freq)) +
  geom_bar(stat = "identity") +
  xlab("Words") +
  ylab("Frequency") + theme_minimal() +
  theme(axis.text.x=element_text(size=12,color='black',fac='bold.italic',angle=45,hjust=0.5))
p1
```

Here are TOP10 most frequently used words that in speeches of President Bush. Notice that Bush also frequently used words like "america", "american", "nation", but he does not mention that much about jobs. He uses "applause" most frequently.
<p style="text-align: left; font-size:20px; font-weight:bold;">Words frequency of President George W. Bush</p>
```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
# bar plot of top10 words of bush
bush = as.matrix(dtm_bush)
mfreq_d = colSums(as.matrix(dtm_bush))
mfreq_d_df = data.frame(word=names(mfreq_d),freq=mfreq_d)
mfreq_d_df = mfreq_d_df[order(mfreq_d_df$freq, decreasing=TRUE), ]
mfreq_d_df = mfreq_d_df[1:10, ]
mfreq_d_df = data.frame(id=c(1:10), word=mfreq_d_df$word, freq=mfreq_d_df$freq)
ggplot(mfreq_d_df, aes(x = reorder(word, id), y = freq)) +
  geom_bar(stat = "identity") +
  xlab("Words") +
  ylab("Frequency") + theme_minimal() +
  theme(axis.text.x=element_text(size=12,color='black',fac='bold.italic',angle=45,hjust=0.5))
```
To see similarities in use of words between President Obama and President Bush visually, we use word cloud as shown below.

<p style="text-align: left; font-size:20px; font-weight:bold;">Wordcloud of President Barack Obama</p>
```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
# word cloud of obama
set.seed(111)
min_freq = 80
wordcloud(names(mfreq_r),mfreq_r,
          min.freq=min_freq,
          scale=c(4,0.5),
          colors=brewer.pal(8, "Dark2"),
          random.color=FALSE, 
          random.order=FALSE)
```

<p style="text-align: left; font-size:20px; font-weight:bold;">Wordcloud of President George W. Bush</p>
```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
# word cloud of bush
set.seed(111)
min_freq = 90
wordcloud(names(mfreq_d),mfreq_d,
          min.freq=min_freq,
          scale=c(4,0.5),
          colors=brewer.pal(8, "Dark2"),
          random.color=FALSE, 
          random.order=FALSE)
```

Next we look at the top 10 most frequently used words for each year in the presidents' tenure. We use heat map to visualize the frequency of each year. Note that x-axis includes all the top 10 words from each year in the tenure.
<p style="text-align: left; font-size:20px; font-weight:bold;">Reactive Heatmap of President Barack Obama</p>
```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
# build dictionaries for obama
obama_year <- as.character(unique(information$year_x[which(information$name == "Barack Obama")]))

text_obama <- vector(mode="list", length=length(obama_year))
for (i in 1:length(obama_year)){
  index = information[information$year_x==obama_year[i],]$index
  text_obama[[i]] = dtm[index,]
}
names(text_obama) <- obama_year

freq_obama <- vector(mode="list", length=length(obama_year))
for (i in 1:length(obama_year)){
  freq_obama[[i]] = colSums(as.matrix(text_obama[[i]]))
}  
names(freq_obama) <- obama_year

# heat map for top words of Barack Obama 
top10word_obama <- vector(mode="list", length=length(obama_year))
word_union <- c()
for (i in 1:length(obama_year)){
  top10word_obama[[i]] = sort(freq_obama[[i]][freq_obama[[i]]>0], decreasing = T)[0:10]
  word_union = union(word_union,names(top10word_obama[[i]]))
}  
names(top10word_obama) <- obama_year

top10word_matrix_obama <- matrix(0, nrow = length(obama_year), ncol = length(word_union))
rownames(top10word_matrix_obama) <- obama_year
colnames(top10word_matrix_obama) <- word_union
for (i in 1:length(obama_year)){
  words_tmp = names(top10word_obama[[i]])
  for (j in 1:10){
    word_tmp = words_tmp[j]
    word_idx = which(word_union==word_tmp)
    top10word_matrix_obama[i,word_idx] = top10word_obama[[i]][[j]]
  }
}

save(top10word_matrix_obama,file="top_words_obama.Rda")

load("top_words_obama.Rda")
library(plotly)
plot_ly(z = top10word_matrix_obama, type = "heatmap",x = word_union,
        y=obama_year,colorbar = list(title = "word count"))%>%
  layout(margin = list(l = 150,b = 100), xaxis=list(title="words"), yaxis=list(title="Tenure of President Obama"), title = "Top words in President Obama's speeches")

```
From the above heat map, we can see that President Obama mentioned the word "tax" for 31 in his speech in 2012. But he never mentioned it during any other years in his tenure. Further, from 2010 to 2015, he keeps mentioning "job". In contrast, he did not mention job at all in his 2009 and 2016 speeches.

<p style="text-align: left; font-size:20px; font-weight:bold;">Reactive Heatmap of President George W. Bush</p>
```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
# build dictionaries for bush
bush_year<- as.character(unique(information$year_x[which(information$name == "George W. Bush")]))
text_bush <- vector(mode="list", length=length(bush_year))
for (i in 1:length(bush_year)){
  index = information[information$year_x==bush_year[i],]$index
  text_bush[[i]] = dtm[index,]
}
names(text_bush) <- bush_year

freq_bush <- vector(mode="list", length=length(bush_year))
for (i in 1:length(bush_year)){
  freq_bush[[i]] = colSums(as.matrix(text_bush[[i]]))
}  
names(freq_bush) <- bush_year

# heatmap for top words of bush 
top10word_bush <- vector(mode="list", length=length(bush_year))
word_union_2 <- c()
for (i in 1:length(bush_year)){
  top10word_bush[[i]] = sort(freq_bush[[i]][freq_bush[[i]]>0], decreasing = T)[0:10]
  word_union = union(word_union,names(top10word_bush[[i]]))
}  
names(top10word_bush) <- bush_year

top10word_matrix_bush <- matrix(0, nrow = length(bush_year), ncol = length(word_union))
rownames(top10word_matrix_bush) <- bush_year
colnames(top10word_matrix_bush) <- word_union
for (i in 1:length(bush_year)){
  words_tmp = names(top10word_bush[[i]])
  for (j in 1:10){
    word_tmp = words_tmp[j]
    word_idx = which(word_union==word_tmp)
    top10word_matrix_bush[i,word_idx] = top10word_bush[[i]][[j]]
  }
}

save(top10word_matrix_bush,file="top_words_bush.Rda")

load("top_words_bush.Rda")
library(plotly)
plot_ly(z = top10word_matrix_bush, type = "heatmap", x = word_union,
        y=bush_year,colorbar = list(title = "word count"))%>%
  layout(margin = list(l = 150,b = 100), xaxis=list(title="words"), yaxis=list(title="Tenure of President Bush"), title = "Top words in President Bush's speeches")

```
The heat map shows that President Bush mentioned the word "tax" for around 20 times during 2001 and 2004 while never mention it in other years. It is not surprising to see that he used "Iraq" for 21 times in his 2007 speech and it is interesting to find that he also used "health" for 18 times during that same speech.
